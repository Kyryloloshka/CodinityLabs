<template>
  <div class="space-y-8">
    <!-- Hero Section -->
    <div class="animate-on-scroll" ref="heroRef">
      <DashboardWelcomeHero 
        :is-authenticated="authStore.isAuthenticated" 
        :user-role="authStore.userRole"
      />
    </div>
    
    <!-- Feature Cards Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" ref="featuresRef">
      <div class="animate-on-scroll animation-delay-100" ref="featureCard1">
        <DashboardFeatureCard
          title="–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–¥—É"
          subtitle="–®–≤–∏–¥–∫–∏–π –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –∑–≤'—è–∑–æ–∫"
          description="–ú–∏—Ç—Ç—î–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞—à–æ–≥–æ –∫–æ–¥—É –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –∞–Ω–∞–ª—ñ–∑–æ–º –ø–æ–º–∏–ª–æ–∫ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è"
          icon="üîç"
          gradient-colors="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
          :tags="['Real-time', 'Feedback', 'Testing']"
        />
      </div>
      
      <div class="animate-on-scroll animation-delay-200" ref="featureCard2">
        <DashboardFeatureCard
          title="–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä"
          subtitle="–ó—Ä—É—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ä–æ–∑—Ä–æ–±–∫–∏"
          description="–ü–æ—Ç—É–∂–Ω–∏–π –æ–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–∫—Ç–æ—Ä –∑ –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É, –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è–º —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é –∑ Git"
          icon="üíª"
          gradient-colors="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
          :tags="['Monaco Editor', 'Syntax Highlighting', 'Auto-complete']"
        />
      </div>
      
      <div class="animate-on-scroll animation-delay-300" ref="featureCard3">
        <DashboardFeatureCard
          title="–ú–∏—Ç—Ç—î–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
          subtitle="–®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä—ñ—à–µ–Ω—å"
          description="–û—Ç—Ä–∏–º—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–∞—à–æ–≥–æ –∫–æ–¥—É –∑–∞ –ª—ñ—á–µ–Ω—ñ —Å–µ–∫—É–Ω–¥–∏ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –∞–Ω–∞–ª—ñ–∑–æ–º –ø–æ–º–∏–ª–æ–∫"
          icon="‚ö°"
          gradient-colors="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
          :tags="['Fast', 'Results', 'Instant']"
        />
      </div>
      
      <div class="animate-on-scroll animation-delay-400" ref="featureCard4">
        <DashboardFeatureCard
          title="–ë–µ–∑–ø–µ—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É"
          subtitle="–Ü–∑–æ–ª—å–æ–≤–∞–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è"
          description="–í–∞—à –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É —ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Ç–∞ —á–∞—Å–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è"
          icon="üîí"
          gradient-colors="linear-gradient(135deg, #fa709a 0%, #fee140 100%)"
          :tags="['Docker', 'Security', 'Isolation']"
        />
      </div>
      
      <div class="animate-on-scroll animation-delay-500" ref="featureCard5">
        <DashboardFeatureCard
          title="–î–µ—Ç–∞–ª—å–Ω—ñ —Ç–µ—Å—Ç-–∫–µ–π—Å–∏"
          subtitle="–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä—ñ—à–µ–Ω—å"
          description="–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∞—à—ñ —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞ –º–Ω–æ–∂–∏–Ω—ñ —Ç–µ—Å—Ç-–∫–µ–π—Å—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ –≥—Ä–∞–Ω–∏—á–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ —Ç–∞ edge cases"
          icon="üß™"
          gradient-colors="linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"
          :tags="['Testing', 'Validation', 'Quality']"
        />
      </div>
      
      <div class="animate-on-scroll animation-delay-600" ref="featureCard6">
        <DashboardFeatureCard
          title="–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥–∞–Ω—å"
          subtitle="–í—ñ–¥—Å—Ç–µ–∂—É–π—Ç–µ —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å"
          description="–ü–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ –≤—Å—ñ —Å–≤–æ—ó —Å–ø—Ä–æ–±–∏ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å, –∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–∫—Ä–∞—â—É–π—Ç–µ –∫–æ–¥"
          icon="üìù"
          gradient-colors="linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)"
          :tags="['History', 'Progress', 'Analysis']"
        />
      </div>
    </div>

    
    <!-- Call to Action for Non-authenticated Users -->
    <div v-if="!authStore.isAuthenticated" class="animate-on-scroll text-center bg-gray-50 dark:bg-gray-800 rounded-xl p-8" ref="ctaRef">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
        –ì–æ—Ç–æ–≤—ñ –ø–æ—á–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è?
      </h2>
      <p class="text-gray-600 dark:text-gray-300 mb-6 max-w-2xl mx-auto">
        –ü—Ä–∏—î–¥–Ω–∞–π—Ç–µ—Å—å –¥–æ —Ç–∏—Å—è—á —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –≤–∂–µ –ø–æ–∫—Ä–∞—â—É—é—Ç—å —Å–≤–æ—ó –Ω–∞–≤–∏—á–∫–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è –Ω–∞ –Ω–∞—à—ñ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <NuxtLink 
          to="/register"
          class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
        >
          <span class="mr-2">üöÄ</span>
          –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç
        </NuxtLink>
        <NuxtLink 
          to="/assignments"
          class="inline-flex items-center px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
        >
          <span class="mr-2">üëÄ</span>
          –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
        </NuxtLink>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
definePageMeta({
  layout: 'default',
  middleware: 'redirect-after-auth'
})

const authStore = useAuthStore()

// Refs for animation
const heroRef = ref<HTMLElement>()
const featureCard1 = ref<HTMLElement>()
const featureCard2 = ref<HTMLElement>()
const featureCard3 = ref<HTMLElement>()
const featureCard4 = ref<HTMLElement>()
const featureCard5 = ref<HTMLElement>()
const featureCard6 = ref<HTMLElement>()
const ctaRef = ref<HTMLElement>()

// Intersection Observer for animations
onMounted(() => {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view')
        }
      })
    },
    {
      threshold: 0.1,
      rootMargin: '50px'
    }
  )

  // Observe all elements with animate-on-scroll class
  const elementsToObserve = [
    heroRef.value,
    featureCard1.value,
    featureCard2.value,
    featureCard3.value,
    featureCard4.value,
    featureCard5.value,
    featureCard6.value,
    ctaRef.value
  ].filter(Boolean)

  elementsToObserve.forEach((el) => {
    if (el) observer.observe(el)
  })

  onUnmounted(() => {
    observer.disconnect()
  })
})
</script> 